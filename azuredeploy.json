{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "2.0.0.0",
  "parameters": {
    "workspaceName": {
      "type": "string",
      "metadata": {
        "description": "Create new or use an existing Log Analytic Workspace"
      }
    },
    "workspaceRegionId": {
      "type": "string",
      "metadata": {
        "description": "Specify the Azure Region for your new or existing OMS workspace"
      }
    },
    "accountName": {
      "type": "string",
      "metadata": {
        "description": "Use an existing Automation account or create a new"
      }
    },
    "regionId": {
      "type": "string",
      "metadata": {
        "description": "Specify the Azure Region for your OMS Automation Account"
      }
    },
    "SolutionName": {
      "type": "string",
      "defaultValue": "HPE OneView for Log Analytics v2.0.0",
      "metadata": {
        "description": "Name of the solution"
      }
    },
    "workbookDisplayName": {
      "type": "string",
      "defaultValue": "HPE OneView for Log Analytics Workbook v2.0.0",
      "metadata": {
        "description": "The friendly name for the workbook that is used in the Gallery or Saved List.  This name must be unique within a resource group."
      }
    },
    "workbookType": {
      "type": "string",
      "defaultValue": "workbook",
      "metadata": {
        "description": "The gallery that the workbook will been shown under. Supported values include workbook, tsg, etc. Usually, this is 'workbook'"
      }
    },
    "workbookomsSolutionsId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    },
    "workbookazureSolutionsId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    },
    "workbookomsSolutionsForSubComponentsId": {
      "type": "string",
      "defaultValue": "[newGuid()]",
      "metadata": {
        "description": "The unique guid for this workbook instance"
      }
    },
    "subscriptionId": {
      "type": "string",
      "defaultValue": "[subscription().subscriptionId]",
      "metadata": {
        "description": "Subscription id"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "Subscription id"
      }
    }
  },
  "variables": {
    "_assetLocation": "https://raw.githubusercontent.com/HewlettPackard/HPE-PowerShell-for-Log-Analytics-Module/v2.0.0/",

    "runbooks": {
      "generateHpeLogAnalyticsLogs": {
        "name": "GenerateHpeLogAnalyticsLogs",
        "version": "2.0.0",
        "description": "This runbook drives the generatation of log records via the Hybrid Runbook Worker.",
        "type": "PowerShell",
        "Id": "",
        "Uri": "[concat(variables('_assetLocation'),'GenerateHpeLogAnalyticsLogs.ps1')]"
      },
      "scheduleHpeLogAnalyticsLogGeneration": {
        "name": "ScheduleHpeLogAnalyticsLogGeneration",
        "version": "2.0.0",
        "description": "This runbook is used to schedule GenerateHpeLogAnalyticsLogs to run periodically.",
        "type": "PowerShell",
        "Id": "",
        "Uri": "[concat(variables('_assetLocation'),'ScheduleHpeLogAnalyticsLogGeneration.ps1')]"
      }
    },
    "omsSolutions": {
      "customSolution": {
        "name": "[parameters('workbookomsSolutionsId')]",
        "solutionName": "[concat(parameters('SolutionName'), '[' ,parameters('workspaceName'), ']')]",
        "publisher": "Hewlett Packard Enterprise",
        "displayName": "HPE OneView for Log Analytics v2.0.0",
        "description": "Monitor HPE OneView managed assets in a hybrid IT environment.",
        "author": "Hewlett Packard Enterprise",
        "savedSearchCategory": "HPE OneView for Log Analytics"
      }
    },
    "azureSolutions": {
      "customSolution": {
        "name": "[parameters('workbookazureSolutionsId')]",
        "solutionName": "[concat(parameters('SolutionName'), '[' ,parameters('workspaceName'), ']')]",
        "publisher": "Hewlett Packard Enterprise",
        "displayName": "HPE OneView for Log Analytics v2.0.0 - Azure Stack Hub",
        "description": "Monitor HPE Azure Stack Hub in a hybrid IT environment.",
        "author": "Hewlett Packard Enterprise",
        "savedSearchCategory": "HPE OneView for Log Analytics - Azure Stack Hub"
      }
    },
    "omsSolutionsForSubComponents": {
      "customSolution": {
        "name": "[parameters('workbookomsSolutionsForSubComponentsId')]",
        "solutionName": "[concat(parameters('SolutionName'), '[' ,parameters('workspaceName'), ']')]",
        "publisher": "Hewlett Packard Enterprise",
        "displayName": "HPE OneView for Log Analytics v2.0.0 - Server Hardware",
        "description": "Monitor HPE OneView managed assets in a hybrid IT environment.",
        "author": "Hewlett Packard Enterprise",
        "savedSearchCategory": "HPE OneView for Log Analytics - Server Hardware Components"
      }
    },
    "savedQueryArray": [
      {
        "query": "union HPEOneView*_v1_CL| where status_s != \"OK\" and Type != \"HPEOneView_Alerts_v1_CL\" and Type != \"HPEOneView_OneViewAppliance_v1_CL\" | summarize arg_max(TimeGenerated, *) by uri_s",
        "displayName": "All Managed Element Issues"
      },
      {
        "query": "union HPEOneView*_v1_CL | project Type | distinct Type",
        "displayName": "All Log Record Types Generated by the Solution"
      },
      {
        "query": "union HPEOneView*_v1_CL | project Type,TimeGenerated | where Type contains \"HPEOneView\" | summarize arg_max(TimeGenerated, *) by Type",
        "displayName": "Last TimeGenerated for each Log Record Type"
      },
      {
        "query": "HPEOneView_OneViewAppliance_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*), Status=any(overallApplianceStatus_s) by applianceName_s | where overallApplianceStatus_s != \"OK\"",
        "displayName": "All the Appliances with Issues"
      },
      {
        "query": "HPEOneView_ServerHardware_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uuid_g | where status_s != \"OK\"",
        "displayName": "All the Server Hardware with Issues"
      },
      {
        "query": "HPEOneView_ServerHardware_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uuid_g | where powerState_s =='Off'",
        "displayName": "All the Server Hardware that is powered off"
      },
      {
        "query": "HPEOneView_ServerProfiles_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the Server profiles with Issues"
      },
      {
        "query": "HPEOneView_Interconnects_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the Interconnects with Issues"
      },
      {
        "query": "HPEOneView_LogicalInterconnects_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the Logical Interconnects with Issues"
      },
      {
        "query": "HPEOneView_SASInterconnects_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the SASInterconnects with Issues"
      },
      {
        "query": "HPEOneView_StorageSystems_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the Storage Systems with Issues"
      },
      {
        "query": "HPEOneView_StorageSystems_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | project TotalCapacity=todecimal(totalCapacity_s), FreeCapacity=todecimal(freeCapacity_s), AllocatedCapacity=todecimal(allocatedCapacity_s)|project AllocatedCapacity , TotalCapacity, PercentAllocated=round(((AllocatedCapacity/TotalCapacity)*100),2)| where (PercentAllocated > 90)",
        "displayName": "All the Storage Systems where 90 percent of total capacity is used"
      },
      {
        "query": "HPEOneView_StoragePools_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the Storage pools with Issues"
      },
      {
        "query": "HPEOneView_StoragePools_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | project TotalCapacity=todecimal(totalCapacity_s), FreeCapacity=todecimal(freeCapacity_s), AllocatedCapacity=todecimal(allocatedCapacity_s)|project AllocatedCapacity , TotalCapacity, PercentAllocated=round(((AllocatedCapacity/TotalCapacity)*100),2)| where (PercentAllocated > 90)",
        "displayName": "All the Storage pools where 90 percent of total capacity is used"
      },
      {
        "query": "HPEOneView_StorageVolumes_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the Storage Volumes with Issues"
      },
      {
        "query": "HPEOneView_StorageVolumes_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where isShareable_b == \"TRUE\"",
        "displayName": "All the Shareable Storage Volumes"
      },
      {
        "query": "HPEOneView_DriveEnclosures_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the DriveEnclosures with Issues"
      },
      {
        "query": "HPEOneView_Enclosures_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the Enclosures with Issues"
      }

    ],
    "savedAzureStackQueryArray": [
      {
        "query": "HPEOneView_AzureStackHub_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*), Status=any(AzureStackHubOverallHardwareStatus_s) by AzureStackApplianceName_s | where AzureStackHubOverallHardwareStatus_s != \"OK\"",
        "displayName": "All the Azure Stack Hub with Issues"
      },
      {
        "query": "HPEOneView_ServerHardware_v1_CL | where partOfAzureStackInstance_s == true | summarize TimeGenerated = arg_max(TimeGenerated,*) by uuid_g | where status_s != \"OK\"",
        "displayName": "All the Azure Stack Nodes with Issues"
      },
      {
        "query": "HPEOneView_ServerHardware_v1_CL | where partOfAzureStackInstance_s == true | summarize TimeGenerated = arg_max(TimeGenerated,*) by uuid_g | where powerState_s =='Off'",
        "displayName": "All the Azure Stack Nodes that is powered off"
      },
      {
        "query": "HPEOneView_ServerProfiles_v1_CL | where partOfAzureStackInstance_s == true | summarize TimeGenerated = arg_max(TimeGenerated,*) by uri_s | where status_s != \"OK\"",
        "displayName": "All the Azure Stack Node Server profiles with Issues"
      }
    ],
    "savedServerComponentQueryArray": [
      {
        "query": "HPEOneView_StorageModule_v1_CL | summarize TimeGenerated = arg_max(TimeGenerated,*) by SerialNumber_s | where Status_Health_s != \"OK\"",
        "displayName": "All the Server Storage with Issues"
      },
      {
        "query": "HPEOneView_MemoryModule_v1_CL| summarize TimeGenerated = arg_max(TimeGenerated,*) by MemoryGuid_s| where Status_Health_s != \"OK\"",
        "displayName": "All the Server Memory with Issues"
      },
      {
        "query": "HPEOneView_PhysicalDrive_v1_CL| summarize TimeGenerated = arg_max(TimeGenerated,*) by SerialNumber_s| where Status_Health_s != \"OK\"",
        "displayName": "All the Server Storage PhysicalDrives with Issues"
      },
      {
        "query": "HPEOneView_LogicalDrive_v1_CL| summarize TimeGenerated = arg_max(TimeGenerated,*) by VolumeUniqueIdentifier_g| where Status_Health_s != \"OK\"",
        "displayName": "All the Server Storage LogicalDrives with Issues"
      },
      {
        "query": "let ServerName = [** Server Name **];let HPEOVServerHardware = HPEOneView_ServerHardware_v1_CL | where Computer == ServerName| summarize TimeGenerated = arg_max(TimeGenerated,*) by serialNumber_s | project Status=status_s,ComputerName=Computer, Type;let HPEOVStorageModule = HPEOneView_StorageModule_v1_CL| where ServerName_s == ServerName | summarize TimeGenerated = arg_max(TimeGenerated,*) by SerialNumber_s | project Status=Status_Health_s,Location=Location_s, Type;let HPEOVMemoryModule = HPEOneView_MemoryModule_v1_CL | where ServerName_s == ServerName | summarize TimeGenerated = arg_max(TimeGenerated,*) by MemoryGuid_s | project Location=DeviceLocator_s,Status=Status_Health_s,Type;let HPEOVStorageModulePhysicalDrive = HPEOneView_PhysicalDrive_v1_CL | where ServerName_s == ServerName  | summarize TimeGenerated = arg_max(TimeGenerated,*) by SerialNumber_s | project Location=Location_s,Status=Status_Health_s,Type,VolumeID=LogicalDriveUniqueID_g;let HPEOVStorageModuleLogicalDrive = HPEOneView_LogicalDrive_v1_CL | where ServerName_s == ServerName  | summarize TimeGenerated = arg_max(TimeGenerated,*) by VolumeUniqueIdentifier_g | project VolumeID=VolumeUniqueIdentifier_g,Status=Status_Health_s,Type;union HPEOVServerHardware, HPEOVStorageModule, HPEOVMemoryModule, HPEOVStorageModulePhysicalDrive, HPEOVStorageModuleLogicalDrive",
        "displayName": "All the Server hardware with sub-components"
      }
    ]
  },
  "resources": [
    {
      "name": "[parameters('workspaceName')]",
      "type": "Microsoft.OperationalInsights/workspaces",
      "apiVersion": "2015-11-01-preview",
      "location": "[parameters('workspaceRegionId')]",
      "properties": {},
      "resources": [
        {
          "apiVersion": "2018-06-01-preview",
          "name": "[variables('omsSolutions').customSolution.name]",
          "type": "microsoft.insights/workbooks",
          "id": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookomsSolutionsId'))]",
          "dependson": [
            "[Concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
          ],
          "location": "[resourceGroup().location]",
          "kind": "shared",
          "properties": {
            "Name": "[variables('omsSolutions').customSolution.name]",
            "DisplayName": "[variables('omsSolutions').customSolution.displayName]",
            "Author": "[variables('omsSolutions').customSolution.author]",
            "id": "HPE OneView Workbook",
            "version": "2",
            "sourceId": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]",
            "fallbackResourceIds": "[Concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]",
            "category": "[parameters('workbookType')]",
            "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"<div style=\\\"background-color:rgb(0,158,73);color:white;height:80px;border:SOLID 1px;\\\">\\r\\n\\t<h1 style=\\\"text-align:center;\\\">HPE OneView for Microsoft Azure Log Analytics (v2.0.0)\\r\\n\\t<a style=\\\"text-align:center;color:white;font-size: 12px;text-decoration: underline;\\\" href=\\\"https://www.hpe.com/us/en/product-catalog/detail/pip.1010838356.html\\\" title=\\\"HPE OneView for Microsoft Azure Log Analytics (v2.0.0)\\\">More Info</a></h1>\\t\\r\\n</div>\\r\\n<hr>\\r\\n\\r\\n<h2 style=\\\"color:rgb(0,158,73);\\\">Hybrid IT Management</h2>\\r\\nProvides a bridge between Microsoft cloud management services and HPE hardware infrastructure.\\r\\n\\r\\n<h2 style=\\\"color:rgb(0,158,73);\\\">Manage on-premises HPE infrastructure</h2>\\r\\nData is automatically collected from HPE OneView and HPE Synergy to bring visibility of HPE infrastructure hardware, inventory, health and status, and long term event correlation and trend analysis.\\r\\n\\r\\n<h2 style=\\\"color:rgb(0,158,73);\\\">Provide feedback</h2>\\r\\nTo provide feedback on this solution, please contact ov4alafeedback@hpe.com. This email should not be used for technical support. Documentation can be found at \\r\\n<a style=\\\"text-decoration: underline;\\\" href=\\\"www.hpe.com/info/ov4la-docs\\\" title=\\\"www.hpe.com/info/ov4la-docs\\\">www.hpe.com/info/ov4la-docs.</a>\"},\"name\":\"text - 0\",\"styleSettings\":{\"margin\":\"10px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW APPLIANCES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (applianceName_s:string,overallApplianceStatus_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_OneViewAppliance_v1_CL | summarize arg_max(TimeGenerated, *) by applianceName_s | summarize AggregatedValue = dcount(applianceName_s) by overallApplianceStatus_s | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Appliance Status\",\"noDataMessage\":\"No OneView Appliance Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\",\"styleSettings\":{\"margin\":\"0px\",\"padding\":\"0px\",\"maxWidth\":\"100%\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (applianceLaunchURL_s:string, applianceName_s:string,overallApplianceStatus_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_OneViewAppliance_v1_CL | summarize arg_max(TimeGenerated, *) by applianceName_s | project applianceName_s, overallApplianceStatus_s, applianceLaunchURL_s\",\"size\":1,\"noDataMessage\":\"No OneView Appliance Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW APPLIANCES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"maxWidth\":\"100%\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW SERVER HARDWARE\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uuid_g:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerHardware_v1_CL | summarize arg_max(TimeGenerated, *) by uuid_g | summarize AggregatedValue = dcount(uuid_g) by status_s | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Server Status\",\"noDataMessage\":\"No Server Hardware Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uuid_g:string, status_s:string, Computer:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerHardware_v1_CL | summarize arg_max(TimeGenerated, *) by uuid_g | project Computer, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Server Hardware Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW SERVER HARDWARE\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW SERVER PROFILES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerProfiles_v1_CL  | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Server Profile Status\",\"noDataMessage\":\"No Server Profile Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Critical\",\"color\":\"red\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string, name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerProfiles_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Server Profile Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"name\":\"HPE ONEVIEW SERVER PROFILES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW ENCLOSURES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_Enclosures_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Enclosure Status\",\"noDataMessage\":\"No Enclosure Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string, name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_Enclosures_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Enclosure Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW ENCLOSURES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW LOGICAL INTERCONNECTS\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_LogicalInterconnects_v1_CL  | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Logical Interconnect Status\",\"noDataMessage\":\"No Logical Interconnect Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string, name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_LogicalInterconnects_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Logical Interconnect Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW LOGICAL INTERCONNECTS\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW INTERCONNECTS\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_Interconnects_v1_CL  | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Interconnect Status\",\"noDataMessage\":\"No Interconnect Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string, name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_Interconnects_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Interconnect Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW INTERCONNECTS\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW STORAGE SYSTEMS\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_StorageSystems_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Storage System Status\",\"noDataMessage\":\"No Storage System Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string, name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_StorageSystems_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Storage System Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW STORAGE SYSTEMS\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW STORAGE POOLS\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_StoragePools_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Storage Pool Status\",\"noDataMessage\":\"No Storage Pool Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"red\"},{\"seriesName\":\"Disabled\",\"color\":\"gray\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string, name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_StoragePools_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Storage Pool Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW STORAGE POOLS\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW STORAGE VOLUMES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_StorageVolumes_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Storage Volume Status\",\"noDataMessage\":\"No Storage Volume Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string, name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_StorageVolumes_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Storage Volume Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW STORAGE VOLUMES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW SAS INTERCONNECTS\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string,status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_SASInterconnects_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"SAS Interconnects Status\",\"noDataMessage\":\"No SAS Interconnects Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string,status_s:string,name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_SASInterconnects_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No SAS Interconnects Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW SAS INTERCONNECTS\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW DRIVE ENCLOSURES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string,status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_DriveEnclosures_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Drive Enclosure Status\",\"noDataMessage\":\"No Drive Enclosure Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string,status_s:string,name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_DriveEnclosures_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Drive Enclosure Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW DRIVE ENCLOSURES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"ALERTS\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (applianceName_s:string)[];let lastTimeGenerated = toscalar (union isfuzzy=true EmptyTable,HPEOneView_Alerts_v1_CL | where TimeGenerated > ago(7d) | summarize arg_max(TimeGenerated, *) by applianceName_s | summarize makeset(TimeGenerated) | project set_TimeGenerated);union isfuzzy=true EmptyTable,HPEOneView_Alerts_v1_CL | where TimeGenerated > ago(7d) | where TimeGenerated in (lastTimeGenerated) | count\",\"size\":1,\"title\":\"Alerts\",\"noDataMessage\":\"No Alerts Available\",\"timeContext\":{\"durationMs\":604800000},\"showRefreshButton\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"showBorder\":false},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (applianceName_s:string, description_s:string, applianceLaunchURL_s:string)[];let lastTimeGenerated = toscalar (union isfuzzy=true EmptyTable,HPEOneView_Alerts_v1_CL | where TimeGenerated > ago(7d) | summarize arg_max(TimeGenerated, *) by applianceName_s | summarize makeset(TimeGenerated) | project set_TimeGenerated); union isfuzzy=true EmptyTable,HPEOneView_Alerts_v1_CL | where TimeGenerated > ago(7d) | where TimeGenerated in (lastTimeGenerated) | project TimeGenerated, applianceName_s, description_s, applianceLaunchURL_s\",\"size\":1,\"noDataMessage\":\"No Alerts Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"ALERTS\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}}],\"isLocked\":false}"
          }

        },
        {
          "apiVersion": "2018-06-01-preview",
          "name": "[variables('azureSolutions').customSolution.name]",
          "type": "microsoft.insights/workbooks",
          "id": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookazureSolutionsId'))]",
          "dependson": [
            "[Concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
          ],
          "location": "[resourceGroup().location]",
          "kind": "shared",
          "properties": {
            "Name": "[variables('azureSolutions').customSolution.name]",
            "DisplayName": "[variables('azureSolutions').customSolution.displayName]",
            "Author": "[variables('azureSolutions').customSolution.author]",
            "id": "HPE OneView Azure Hub Workbook",
            "version": "2",
            "sourceId": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]",
            "fallbackResourceIds": "[Concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]",
            "category": "[parameters('workbookType')]",
            "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"<div style=\\\"background-color:rgb(0,158,73);color:white;height:80px;border:SOLID 1px;\\\">\\r\\n\\t<h1 style=\\\"text-align:center;\\\">HPE OneView for Log Analytics v2.0.0 - Azure Stack Hub\\r\\n\\t<a style=\\\"text-align:center;color:white;font-size: 12px;text-decoration: underline;\\\" href=\\\"https://www.hpe.com/us/en/product-catalog/detail/pip.1010838356.html\\\" title=\\\"HPE OneView for Microsoft Azure Log Analytics (v2.0.0)\\\">More Info</a></h1>\\t\\r\\n</div>\\r\\n<hr>\\r\\n\\r\\n<h2 style=\\\"color:rgb(0,158,73);\\\">Hybrid IT Management</h2>\\r\\nProvides a bridge between Microsoft cloud management services and HPE hardware infrastructure.\\r\\n\\r\\n<h2 style=\\\"color:rgb(0,158,73);\\\">Manage on-premises HPE infrastructure</h2>\\r\\nData is automatically collected from HPE OneView and HPE Synergy to bring visibility of HPE infrastructure hardware, inventory, health and status, and long term event correlation and trend analysis.\\r\\n\\r\\n<h2 style=\\\"color:rgb(0,158,73);\\\">Provide feedback</h2>\\r\\nTo provide feedback on this solution, please contact ov4alafeedback@hpe.com. This email should not be used for technical support. Documentation can be found at \\r\\n<a style=\\\"text-decoration: underline;\\\" href=\\\"www.hpe.com/info/ov4la-docs\\\" title=\\\"www.hpe.com/info/ov4la-docs\\\">www.hpe.com/info/ov4la-docs.</a>\"},\"name\":\"text - 0\",\"styleSettings\":{\"margin\":\"10px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"AZURE STACK HUBS\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (AzureStackApplianceName_s:string,AzureStackHubOverallHardwareStatus_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_AzureStackHub_v1_CL | summarize arg_max(TimeGenerated, *) by AzureStackApplianceName_s | summarize AggregatedValue = dcount(AzureStackApplianceName_s) by AzureStackHubOverallHardwareStatus_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Azure Stack Hub Status\",\"noDataMessage\":\"No Azure Stack Hub Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\",\"styleSettings\":{\"margin\":\"0px\",\"padding\":\"0px\",\"maxWidth\":\"100%\"}},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (AzureStackApplianceName_s:string,AzureStackHubOverallHardwareStatus_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_AzureStackHub_v1_CL | summarize arg_max(TimeGenerated, *) by AzureStackApplianceName_s | project AzureStackApplianceName_s, AzureStackHubOverallHardwareStatus_s\",\"size\":1,\"noDataMessage\":\"No Azure Stack Hub Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"AZURE STACK HUBS\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"maxWidth\":\"100%\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"AZURE STACK NODES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uuid_g:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerHardware_v1_CL | where partOfAzureStackInstance_s == true | summarize arg_max(TimeGenerated, *) by uuid_g | summarize AggregatedValue = dcount(uuid_g) by status_s | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Azure Stack Node Status\",\"noDataMessage\":\"No Azure Stack Node Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uuid_g:string, status_s:string, Computer:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerHardware_v1_CL | where partOfAzureStackInstance_s == true | summarize arg_max(TimeGenerated, *) by uuid_g | project Computer, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Azure Stack Node Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"AZURE STACK NODES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"AZURE STACK NODE SERVER PROFILES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerProfiles_v1_CL | where partOfAzureStackInstance_s == true  | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Server Profile Status\",\"noDataMessage\":\"No Server Profile Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Critical\",\"color\":\"red\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string, name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerProfiles_v1_CL  | where partOfAzureStackInstance_s == true | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Server Profile Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"name\":\"AZURE STACK NODE SERVER PROFILES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"ALERTS\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (applianceName_s:string)[];let lastTimeGenerated = toscalar (union isfuzzy=true EmptyTable,HPEOneView_Alerts_v1_CL | where partOfAzureStackInstance_s == true | where TimeGenerated > ago(7d) | summarize arg_max(TimeGenerated, *) by applianceName_s | summarize makeset(TimeGenerated) | project set_TimeGenerated);union isfuzzy=true EmptyTable,HPEOneView_Alerts_v1_CL | where partOfAzureStackInstance_s == true | where TimeGenerated > ago(7d) | where TimeGenerated in (lastTimeGenerated) | count\",\"size\":1,\"title\":\"Alerts\",\"noDataMessage\":\"No Alerts Available\",\"timeContext\":{\"durationMs\":604800000},\"showRefreshButton\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"tileSettings\":{\"showBorder\":false},\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (applianceName_s:string, description_s:string, applianceLaunchURL_s:string)[];let lastTimeGenerated = toscalar (union isfuzzy=true EmptyTable,HPEOneView_Alerts_v1_CL | where partOfAzureStackInstance_s == true | where TimeGenerated > ago(7d) | summarize arg_max(TimeGenerated, *) by applianceName_s | summarize makeset(TimeGenerated) | project set_TimeGenerated); union isfuzzy=true EmptyTable,HPEOneView_Alerts_v1_CL | where partOfAzureStackInstance_s == true | where TimeGenerated > ago(7d) | where TimeGenerated in (lastTimeGenerated) | project TimeGenerated, applianceName_s, description_s, applianceLaunchURL_s\",\"size\":1,\"noDataMessage\":\"No Alerts Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":2000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"ALERTS\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}}],\"isLocked\":false}"
          }
        },
        {
          "apiVersion": "2018-06-01-preview",
          "name": "[variables('omsSolutionsForSubComponents').customSolution.name]",
          "type": "microsoft.insights/workbooks",
          "id": "[resourceId( 'microsoft.insights/workbooks', parameters('workbookomsSolutionsForSubComponentsId'))]",
          "dependson": [
            "[Concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
          ],
          "location": "[resourceGroup().location]",
          "kind": "shared",
          "properties": {
            "Name": "[variables('omsSolutionsForSubComponents').customSolution.name]",
            "DisplayName": "[variables('omsSolutionsForSubComponents').customSolution.displayName]",
            "Author": "[variables('omsSolutionsForSubComponents').customSolution.author]",
            "id": "HPE OneView Sub Components Workbook",
            "version": "2",
            "sourceId": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]",
            "fallbackResourceIds": "[Concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]",
            "category": "[parameters('workbookType')]",
            "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"<div style=\\\"background-color:rgb(0,158,73);color:white;height:80px;border:SOLID 1px;\\\">\\r\\n\\t<h1 style=\\\"text-align:center;\\\">HPE OneView for Log Analytics v2.0.0 - Server Hardware\\r\\n\\t<a style=\\\"text-align:center;color:white;font-size: 12px;text-decoration: underline;\\\" href=\\\"https://www.hpe.com/us/en/product-catalog/detail/pip.1010838356.html\\\" title=\\\"HPE OneView for Microsoft Azure Log Analytics (v2.0.0)\\\">More Info</a></h1>\\t\\r\\n</div>\\r\\n<hr>\\r\\n\\r\\n<h2 style=\\\"color:rgb(0,158,73);\\\">Hybrid IT Management</h2>\\r\\nProvides a bridge between Microsoft cloud management services and HPE hardware infrastructure.\\r\\n\\r\\n<h2 style=\\\"color:rgb(0,158,73);\\\">Manage on-premises HPE infrastructure</h2>\\r\\nData is automatically collected from HPE OneView and HPE Synergy to bring visibility of HPE infrastructure hardware, inventory, health and status, and long term event correlation and trend analysis.\\r\\n\\r\\n<h2 style=\\\"color:rgb(0,158,73);\\\">Provide feedback</h2>\\r\\nTo provide feedback on this solution, please contact ov4alafeedback@hpe.com. This email should not be used for technical support. Documentation can be found at \\r\\n<a style=\\\"text-decoration: underline;\\\" href=\\\"www.hpe.com/info/ov4la-docs\\\" title=\\\"www.hpe.com/info/ov4la-docs\\\">www.hpe.com/info/ov4la-docs.</a>\"},\"name\":\"text - 0\",\"styleSettings\":{\"margin\":\"10px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW SERVER HARDWARE\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uuid_g:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerHardware_v1_CL | summarize arg_max(TimeGenerated, *) by uuid_g | summarize AggregatedValue = dcount(uuid_g) by status_s | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Server Status\",\"noDataMessage\":\"No Server Hardware Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uuid_g:string, status_s:string, Computer:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerHardware_v1_CL | summarize arg_max(TimeGenerated, *) by uuid_g | project Computer, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Server Hardware Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"HPE ONEVIEW SERVER HARDWARE\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"HPE ONEVIEW SERVER PROFILES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerProfiles_v1_CL  | summarize arg_max(TimeGenerated, *) by uri_s | summarize AggregatedValue = dcount(uri_s) by status_s  | sort by AggregatedValue desc\",\"size\":1,\"title\":\"Server Profile Status\",\"noDataMessage\":\"No Server Profile Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Critical\",\"color\":\"red\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (uri_s:string, status_s:string, name_s:string, LaunchInContextURI_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_ServerProfiles_v1_CL | summarize arg_max(TimeGenerated, *) by uri_s | project name_s, status_s, LaunchInContextURI_s\",\"size\":1,\"noDataMessage\":\"No Server Profile Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"name\":\"HPE ONEVIEW SERVER PROFILES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"MEMORY MODULE\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (MemoryGuid_s:string, Status_Health_s:string)[];union isfuzzy=true EmptyTable, HPEOneView_MemoryModule_v1_CL|summarize arg_max(TimeGenerated, *) by MemoryGuid_s |summarize AggregatedValue = dcount(MemoryGuid_s) by Status_Health_s |sort by AggregatedValue desc\",\"size\":1,\"title\":\"Module Status\",\"noDataMessage\":\"No Memory Module Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (MemoryGuid_s:string, Status_Health_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_MemoryModule_v1_CL | summarize arg_max(TimeGenerated, *) by MemoryGuid_s |project ServerName_s,Status_Health_s,DeviceLocator_s\",\"size\":1,\"noDataMessage\":\"No Memory Module Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"MEMORY MODULE\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"PHYSICAL DRIVES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (SerialNumber_s:string, Status_Health_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_PhysicalDrive_v1_CL | summarize arg_max(TimeGenerated, *) by SerialNumber_s | summarize AggregatedValue = dcount(SerialNumber_s) by Status_Health_s |sort by AggregatedValue desc\",\"size\":1,\"title\":\"Drive Status\",\"noDataMessage\":\"No Physical Drive Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (SerialNumber_s:string, Status_Health_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_PhysicalDrive_v1_CL | summarize arg_max(TimeGenerated, *) by SerialNumber_s |project ServerName_s,Status_Health_s,Location_s\",\"size\":1,\"noDataMessage\":\"No Physical Drive Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"PHYSICAL DRIVES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}},{\"type\":12,\"content\":{\"version\":\"NotebookGroup/1.0\",\"groupType\":\"editable\",\"title\":\"LOGICAL DRIVES\",\"items\":[{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (VolumeUniqueIdentifier_g:string, Status_Health_s:string)[];union isfuzzy=true EmptyTable, HPEOneView_LogicalDrive_v1_CL|summarize arg_max(TimeGenerated, *) by VolumeUniqueIdentifier_g |summarize AggregatedValue = dcount(VolumeUniqueIdentifier_g) by Status_Health_s |sort by AggregatedValue desc\",\"size\":1,\"title\":\"Drive Status\",\"noDataMessage\":\"No Logical Drive Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"OK\",\"color\":\"green\"},{\"seriesName\":\"Warning\",\"color\":\"yellow\"},{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"Unknown\",\"color\":\"gray\"}]}},\"customWidth\":\"40\",\"name\":\"query - 0\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let EmptyTable = datatable (VolumeUniqueIdentifier_g:string, Status_Health_s:string)[];union isfuzzy=true EmptyTable,HPEOneView_LogicalDrive_v1_CL | summarize arg_max(TimeGenerated, *) by VolumeUniqueIdentifier_g |project ServerName_s,Status_Health_s,VolumeUniqueIdentifier_g\",\"size\":1,\"noDataMessage\":\"No Logical Drive Available\",\"timeContext\":{\"durationMs\":86400000},\"showRefreshButton\":true,\"showExportToExcel\":true,\"exportToExcelOptions\":\"all\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":10000,\"filter\":true}},\"customWidth\":\"60\",\"name\":\"query - 1\"}]},\"customWidth\":\"100\",\"name\":\"LOGICAL DRIVES\",\"styleSettings\":{\"margin\":\"20px\",\"padding\":\"20px\",\"showBorder\":true}}],\"isLocked\":false}"
          }

        }
      ]
    },
    {
      "apiVersion": "2015-10-31",
      "location": "[parameters('regionId')]",
      "name": "[parameters('accountName')]",
      "type": "Microsoft.Automation/automationAccounts",
      "properties": {
        "sku": {
          "name": "Basic"
        }
      },
      "resources": [
        {
          "name": "[variables('runbooks').generateHpeLogAnalyticsLogs.name]",
          "type": "runbooks",
          "apiVersion": "2015-10-31",
          "location": "[parameters('regionId')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('accountName'))]"
          ],
          "tags": {},
          "properties": {
            "runbookType": "[variables('runbooks').generateHpeLogAnalyticsLogs.type]",
            "logProgress": "true",
            "logVerbose": "true",
            "description": "[variables('runbooks').generateHpeLogAnalyticsLogs.description]",
            "publishContentLink": {
              "uri": "[variables('runbooks').generateHpeLogAnalyticsLogs.Uri]",
              "version": "[variables('runbooks').generateHpeLogAnalyticsLogs.version]"
            }
          }
        },
        {
          "name": "[variables('runbooks').scheduleHpeLogAnalyticsLogGeneration.name]",
          "type": "runbooks",
          "apiVersion": "2015-10-31",
          "location": "[parameters('regionId')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('accountName'))]"
          ],
          "tags": {},
          "properties": {
            "runbookType": "[variables('runbooks').scheduleHpeLogAnalyticsLogGeneration.type]",
            "logProgress": "true",
            "logVerbose": "true",
            "description": "[variables('runbooks').scheduleHpeLogAnalyticsLogGeneration.description]",
            "publishContentLink": {
              "uri": "[variables('runbooks').scheduleHpeLogAnalyticsLogGeneration.Uri]",
              "version": "[variables('runbooks').scheduleHpeLogAnalyticsLogGeneration.version]"
            }
          }
        }

      ]
    },
    {
      "apiVersion": "2017-03-15-preview",
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "name": "[concat(parameters('workspaceName'), '/', tolower(variables('omsSolutions').customSolution.savedSearchCategory), '|', toLower(variables('savedQueryArray')[copyIndex()].displayName))]",
      "copy": {
        "name": "savedsearchcopy",
        "count": "[length(variables('savedQueryArray'))]"
      },
      "dependsOn": [
        "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
      ],
      "properties": {
        "etag": "*",
        "query": "[variables('savedQueryArray')[copyIndex()].query]",
        "displayName": "[variables('savedQueryArray')[copyIndex()].displayName]",
        "category": "[variables('omsSolutions').customSolution.savedSearchCategory]"
      }
    },
    {
      "apiVersion": "2017-03-15-preview",
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "name": "[concat(parameters('workspaceName'), '/', tolower(variables('azureSolutions').customSolution.savedSearchCategory), '|', toLower(variables('savedAzureStackQueryArray')[copyIndex()].displayName))]",
      "copy": {
        "name": "savedsearchcopy",
        "count": "[length(variables('savedAzureStackQueryArray'))]"
      },
      "dependsOn": [
        "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
      ],
      "properties": {
        "etag": "*",
        "query": "[variables('savedAzureStackQueryArray')[copyIndex()].query]",
        "displayName": "[variables('savedAzureStackQueryArray')[copyIndex()].displayName]",
        "category": "[variables('azureSolutions').customSolution.savedSearchCategory]"
      }
    },
    {
      "apiVersion": "2017-03-15-preview",
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "name": "[concat(parameters('workspaceName'), '/', tolower(variables('omsSolutionsForSubComponents').customSolution.savedSearchCategory), '|', toLower(variables('savedServerComponentQueryArray')[copyIndex()].displayName))]",
      "copy": {
        "name": "savedsearchcopy",
        "count": "[length(variables('savedServerComponentQueryArray'))]"
      },
      "dependsOn": [
        "[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
      ],
      "properties": {
        "etag": "*",
        "query": "[variables('savedServerComponentQueryArray')[copyIndex()].query]",
        "displayName": "[variables('savedServerComponentQueryArray')[copyIndex()].displayName]",
        "category": "[variables('omsSolutionsForSubComponents').customSolution.savedSearchCategory]"
      }
    },
    {
      "properties": {
        "lenses": {
          "0": {
            "order": 0,
            "parts": {
              "0": {
                "position": {
                  "x": 0,
                  "y": 0,
                  "colSpan": 2,
                  "rowSpan": 2
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ComponentId",
                      "value": {
                        "SubscriptionId": "parameters('subscriptionId')",
                        "ResourceGroup": "parameters('resourceGroupName')",
                        "Name": "OneView Appliance Details",
                        "LinkedApplicationType": 2,

                        "ResourceId": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]",
                        "ResourceType": "microsoft.operationalinsights/workspaces",
                        "IsAzureFirst": false
                      }
                    },
                    {
                      "name": "ResourceIds",
                      "value": [
                        "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                      ],
                      "isOptional": true
                    },
                    {
                      "name": "Type",
                      "value": "workbook",
                      "isOptional": true
                    },
                    {
                      "name": "TimeContext",
                      "isOptional": true
                    },
                    {
                      "name": "ConfigurationId",
                      "value": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/microsoft.insights/workbooks/', parameters('workbookomsSolutionsId'))]",
                      "isOptional": true
                    },
                    {
                      "name": "ViewerMode",
                      "value": false,
                      "isOptional": true
                    },
                    {
                      "name": "GalleryResourceType",
                      "value": "microsoft.operationalinsights/workspaces",
                      "isOptional": true
                    },
                    {
                      "name": "NotebookParams",
                      "isOptional": true
                    },
                    {
                      "name": "Location",
                      "value": "[resourceGroup().location]",
                      "isOptional": true
                    },
                    {
                      "name": "Version",
                      "value": "1.0",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/NotebookPinnedPart",
                  "viewState": {
                    "content": {
                      "configurationId": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/microsoft.insights/workbooks/',parameters('workbookomsSolutionsId'))]"
                    }
                  }
                }
              },
              "1": {
                "position": {
                  "x": 2,
                  "y": 0,
                  "colSpan": 2,
                  "rowSpan": 2
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ComponentId",
                      "value": {
                        "SubscriptionId": "parameters('subscriptionId')",
                        "ResourceGroup": "parameters('resourceGroupName')",
                        "Name": "Azure Stack Hub Details",
                        "LinkedApplicationType": 2,
                        "ResourceId": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]",
                        "ResourceType": "microsoft.operationalinsights/workspaces",
                        "IsAzureFirst": false
                      }
                    },
                    {
                      "name": "ResourceIds",
                      "value": [
                        "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                      ],
                      "isOptional": true
                    },
                    {
                      "name": "Type",
                      "value": "workbook",
                      "isOptional": true
                    },
                    {
                      "name": "TimeContext",
                      "isOptional": true
                    },
                    {
                      "name": "ConfigurationId",
                      "value": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/microsoft.insights/workbooks/', parameters('workbookazureSolutionsId'))]",
                      "isOptional": true
                    },
                    {
                      "name": "ViewerMode",
                      "value": false,
                      "isOptional": true
                    },
                    {
                      "name": "GalleryResourceType",
                      "value": "microsoft.operationalinsights/workspaces",
                      "isOptional": true
                    },
                    {
                      "name": "NotebookParams",
                      "isOptional": true
                    },
                    {
                      "name": "Location",
                      "value": "[resourceGroup().location]",
                      "isOptional": true
                    },
                    {
                      "name": "Version",
                      "value": "1.0",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/NotebookPinnedPart",
                  "viewState": {
                    "content": {
                      "configurationId": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/microsoft.insights/workbooks/', parameters('workbookazureSolutionsId'))]"
                    }
                  }
                }
              },
              "2": {
                "position": {
                  "x": 4,
                  "y": 0,
                  "colSpan": 2,
                  "rowSpan": 2
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ComponentId",
                      "value": {
                        "SubscriptionId": "parameters('subscriptionId')",
                        "ResourceGroup": "parameters('resourceGroupName')",
                        "Name": "Server Hardware Details",
                        "LinkedApplicationType": 2,
                        "ResourceId": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]",
                        "ResourceType": "microsoft.operationalinsights/workspaces",
                        "IsAzureFirst": false
                      }
                    },
                    {
                      "name": "ResourceIds",
                      "value": [
                        "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
                      ],
                      "isOptional": true
                    },
                    {
                      "name": "Type",
                      "value": "workbook",
                      "isOptional": true
                    },
                    {
                      "name": "TimeContext",
                      "isOptional": true
                    },
                    {
                      "name": "ConfigurationId",
                      "value": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/microsoft.insights/workbooks/', parameters('workbookomsSolutionsForSubComponentsId'))]",
                      "isOptional": true
                    },
                    {
                      "name": "ViewerMode",
                      "value": false,
                      "isOptional": true
                    },
                    {
                      "name": "GalleryResourceType",
                      "value": "microsoft.operationalinsights/workspaces",
                      "isOptional": true
                    },
                    {
                      "name": "NotebookParams",
                      "isOptional": true
                    },
                    {
                      "name": "Location",
                      "value": "[resourceGroup().location]",
                      "isOptional": true
                    },
                    {
                      "name": "Version",
                      "value": "1.0",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/NotebookPinnedPart",
                  "viewState": {
                    "content": {
                      "configurationId": "[Concat('/subscriptions/',parameters('subscriptionId'),'/resourcegroups/',parameters('resourceGroupName'),'/providers/microsoft.insights/workbooks/', parameters('workbookomsSolutionsForSubComponentsId'))]"
                    }
                  }
                }
              }
            }
          }
        },
        "metadata": {
          "model": {
            "timeRange": {
              "value": {
                "relative": {
                  "duration": 24,
                  "timeUnit": 1
                }
              },
              "type": "MsPortalFx.Composition.Configuration.ValueTypes.TimeRange"
            }
          }
        }
      },
      "name": "HPEOneviewDashboard",
      "type": "Microsoft.Portal/dashboards",
      "location": "[resourceGroup().location]",
      "tags": {
        "hidden-title": "[concat(parameters('SolutionName'), '-' ,parameters('workspaceName'))]"
      },
      "apiVersion": "2015-08-01-preview"
    }
  ]
}
